---
title: '[Linux Kernel] I2c Driver 分析 (一)'
author: appleboy
type: post
date: -001-11-30T00:00:00+00:00
draft: true
url: /?p=2173
views:
  - 4
categories:
  - Kernel
  - Linux
tags:
  - Linux
  - Linux Kernel

---
在系統 I²C(大部分都寫成 i2c，這是錯誤的寫法以及念法) 初始化之前，會先呼叫 <span style="color:green">postcore_initcall</span>(i2c_init); 以便讓 subsystems 呼叫 <span style="color:green">subsys_initcall</span>() 程式碼，所以底下來解析 <span style="color:green">i2c_init</span> 到底做了哪些事情： 

<pre class="brush: cpp; title: ; notranslate" title="">static int __init i2c_init(void)
{
	int retval;

	retval = bus_register(&#038;i2c_bus_type);
	if (retval)
		return retval;
	retval = class_register(&#038;i2c_adapter_class);
	if (retval)
		goto bus_err;
	retval = i2c_add_driver(&#038;dummy_driver);
	if (retval)
		goto class_err;
	return 0;

class_err:
	class_unregister(&#038;i2c_adapter_class);
bus_err:
	bus_unregister(&#038;i2c_bus_type);
	return retval;
}
</pre> struct bus_type 

<span style="color:green">i2c_bus_typ</span>： 

<pre class="brush: cpp; title: ; notranslate" title="">struct bus_type i2c_bus_type = {
	.name		= "i2c",
	.dev_attrs	= i2c_dev_attrs,
	.match		= i2c_device_match,
	.uevent		= i2c_device_uevent,
	.probe		= i2c_device_probe,
	.remove		= i2c_device_remove,
	.shutdown	= i2c_device_shutdown,
	.suspend	= i2c_device_suspend,
	.resume		= i2c_device_resume,
};
</pre> static struct class 

<span style="color:green">i2c_adapter_class</span>： 

<pre class="brush: cpp; title: ; notranslate" title="">static struct class i2c_adapter_class = {
	.owner			= THIS_MODULE,
	.name			= "i2c-adapter",
	.dev_attrs		= i2c_adapter_attrs,
};</pre> i2c_driver 

<span style="color:green">dummy_driver</span> 

<pre class="brush: cpp; title: ; notranslate" title="">static struct i2c_driver dummy_driver = {
	.driver.name	= "dummy",
	.probe		= dummy_probe,
	.remove		= dummy_remove,
	.id_table	= dummy_id,
};</pre>