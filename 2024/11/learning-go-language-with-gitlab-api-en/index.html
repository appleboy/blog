<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Learning Go Language with GitLab API - 小惡魔 - AppleBOY</title>
<meta name=description content="
Introduction
People often ask me how to learn Go language, and I usually suggest they start with a real project to quickly learn the language&rsquo;s features. Personally, I started with small projects and gradually expanded their scope, from contributing to documentation to open-source projects, then learning how to modify the source code, and finally writing my own project. This learning method allows you to become familiar with the features of the Go language more quickly."><meta name=author content="Appleboy"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"小惡魔 - AppleBOY","url":"https:\/\/blog.wu-boy.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.wu-boy.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/blog.wu-boy.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/blog.wu-boy.com\/2024\/11\/learning-go-language-with-gitlab-api-en\/","name":"Learning go language with git lab API"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"appleboy"},"headline":"Learning Go Language with GitLab API","description":"\nIntroduction People often ask me how to learn Go language, and I usually suggest they start with a real project to quickly learn the language\u0026rsquo;s features. Personally, I started with small projects and gradually expanded their scope, from contributing to documentation to open-source projects, then learning how to modify the source code, and finally writing my own project. This learning method allows you to become familiar with the features of the Go language more quickly.\n","inLanguage":"en","wordCount":1538,"datePublished":"2024-11-16T15:15:56","dateModified":"2024-11-16T15:15:56","image":"https:\/\/lh3.googleusercontent.com\/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080","keywords":[""],"mainEntityOfPage":"https:\/\/blog.wu-boy.com\/2024\/11\/learning-go-language-with-gitlab-api-en\/","publisher":{"@type":"Organization","name":"https:\/\/blog.wu-boy.com\/","logo":{"@type":"ImageObject","url":"https:\/\/lh3.googleusercontent.com\/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080","height":60,"width":60}}}</script><meta property="og:title" content="Learning Go Language with GitLab API"><meta property="og:description" content="
Introduction
People often ask me how to learn Go language, and I usually suggest they start with a real project to quickly learn the language&rsquo;s features. Personally, I started with small projects and gradually expanded their scope, from contributing to documentation to open-source projects, then learning how to modify the source code, and finally writing my own project. This learning method allows you to become familiar with the features of the Go language more quickly."><meta property="og:image" content="https://blog.wu-boy.com/images/2024-11-16/gitlab-flow.png"><meta property="og:url" content="https://blog.wu-boy.com/2024/11/learning-go-language-with-gitlab-api-en/"><meta property="og:type" content="website"><meta property="og:site_name" content="小惡魔 - AppleBOY"><meta name=twitter:title content="Learning Go Language with GitLab API"><meta name=twitter:description content="
Introduction
People often ask me how to learn Go language, and I usually suggest they start with a real project to quickly learn the language&rsquo;s features. Personally, I started with small …"><meta name=twitter:image content="https://blog.wu-boy.com/images/2024-11-16/gitlab-flow.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@appleboy"><meta name=twitter:creator content="@appleboy"><link href=https://i.imgur.com/PpOg8Dz.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.130.0"><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css><link rel=stylesheet href=https://blog.wu-boy.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.wu-boy.com/css/syntax.css><link rel=stylesheet href=https://blog.wu-boy.com/css/codeblock.css></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://blog.wu-boy.com/>小惡魔 - AppleBOY</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title="Youtube 頻道" href=http://bit.ly/youtube-boy><i class="fab fa-youtube"></i> Youtube 頻道</a></li><li class=navlinks-container><a class=navlinks-parent><i class="fas fa-video"></i> 線上課程</a><div class=navlinks-children><a href=/golang-online-course/>Go 語言基礎實戰</a>
<a href=/docker-course/>Docker 容器開發實戰</a>
<a href=/drone-devops/>一天學會 DevOps 自動化流程</a></div></li><li><a title=歷年文章 href=/archives/><i class="fas fa-sitemap fa-lg"></i> 歷年文章</a></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">Search</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="小惡魔 - AppleBOY" href=https://blog.wu-boy.com/><img class=avatar-img src="https://lh3.googleusercontent.com/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080" alt="小惡魔 - AppleBOY"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>Search 小惡魔 - AppleBOY</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>Close</button></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-md-10 col-md-offset-1"><div class=post-heading><h1>Learning Go Language with GitLab API</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on November 16, 2024
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1538&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;appleboy</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-md-10 col-md-offset-1"><aside class=toc-article><nav id=TableOfContents><ul><li><ul><li><a href=#introduction>Introduction</a></li><li><a href=#gitlab-api>GitLab API</a></li><li><a href=#implementation-process>Implementation Process</a></li><li><a href=#screenshot>Screenshot</a></li><li><a href=#simple-example>Simple Example</a><ul><li><a href=#solution-01>Solution 01</a></li><li><a href=#solution-02>Solution 02</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></aside><article role=main class=blog-post><p><img src=/images/2024-11-16/gitlab-flow.png alt=logo></p><h2 id=introduction>Introduction</h2><p>People often ask me how to learn <a href=https://go.dev/>Go language</a>, and I usually suggest they start with a real project to quickly learn the language&rsquo;s features. Personally, I started with small projects and gradually expanded their scope, from contributing to documentation to open-source projects, then learning how to modify the source code, and finally writing my own project. This learning method allows you to become familiar with the features of the Go language more quickly.</p><h2 id=gitlab-api>GitLab API</h2><p>This article will introduce how to use the <a href=https://docs.gitlab.com/ee/api/>GitLab API</a> to learn the Go language. Why choose this topic? As you may know, GitLab is a free and open-source Git version control system that provides a <a href=https://docs.gitlab.com/ee/api/rest/index.html>RESTful API</a> for developers. Through the GitLab API, we can obtain project information, create projects, delete projects, get project file content, etc., or automate some tasks, such as automatically creating CI/CD processes after creating a project or automatically deploying projects to servers. But today, we encounter a problem: if the team&rsquo;s source code is hosted on <a href=https://github.com>GitHub</a> or <a href=https://gitea.com/>Gitea</a>, how can we trigger GitLab CI/CD processes through GitHub or <a href=https://docs.gitea.com/usage/actions/overview>Gitea Action</a>? This way, teams can trigger each other&rsquo;s CI processes across platforms.</p><h2 id=implementation-process>Implementation Process</h2><p>The complete code can be found on <a href=https://github.com/appleboy/drone-gitlab-ci/blob/master/go.mod>GitHub</a>.</p><p>Here we will use the <a href=https://go.dev/>Go language</a> to implement a simple program to obtain project information through the GitLab API. We use the <a href=https://pkg.go.dev/github.com/xanzy/go-gitlab>go-gitlab</a> package, a Go language package for the GitLab API, which makes it easier to use the GitLab API.</p><p>To trigger a GitLab CI Pipeline, only one API is needed. Here we use the <code>CreatePipeline</code> method, which can trigger a CI Pipeline through the project ID.</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#228b22>// Create Gitlab object
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>g, err := <span style=color:#008b45>NewGitlab</span>(p.Host, p.Token, p.Insecure, p.Debug)
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>if</span> err != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>return</span> err
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22>// Create pipeline
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>pipeline, err := g.<span style=color:#008b45>CreatePipeline</span>(p.ProjectID, p.Ref, p.Variables)
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>if</span> err != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>return</span> err
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>However, after this execution, we need to wait for the CI Pipeline to complete. Here we can use the <code>GetPipelineStatus</code> method to get the status of the Pipeline. Since we need to wait for the CI Pipeline to complete, we need a timer <code>Ticker</code> loop to wait for the CI Pipeline to complete. And set a Timeout time, if it exceeds the Timeout time, an error message will be returned.</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-39>39</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#228b22>// Wait for pipeline to complete
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>ticker := time.<span style=color:#008b45>NewTicker</span>(p.Interval)
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>defer</span> ticker.<span style=color:#008b45>Stop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>l.<span style=color:#008b45>Info</span>(<span style=color:#cd5555>&#34;waiting for pipeline to complete&#34;</span>, <span style=color:#cd5555>&#34;timeout&#34;</span>, p.Timeout)
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>for</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>case</span> &lt;-time.<span style=color:#008b45>After</span>(p.Timeout):
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>return</span> errors.<span style=color:#008b45>New</span>(<span style=color:#cd5555>&#34;timeout waiting for pipeline to complete after &#34;</span> + p.Timeout.<span style=color:#008b45>String</span>())
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>case</span> &lt;-ticker.C:
</span></span><span style=display:flex><span>    <span style=color:#228b22>// Check pipeline status
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    status, err := g.<span style=color:#008b45>GetPipelineStatus</span>(p.ProjectID, pipeline.ID)
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>if</span> err != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span> err
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    l.<span style=color:#008b45>Info</span>(<span style=color:#cd5555>&#34;pipeline status&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#cd5555>&#34;status&#34;</span>, status,
</span></span><span style=display:flex><span>      <span style=color:#cd5555>&#34;triggered_by&#34;</span>, pipeline.User.Name,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#228b22>// https://docs.gitlab.com/ee/api/pipelines.html
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#228b22>// created, waiting_for_resource, preparing, pending,
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#228b22>// running, success, failed, canceled, skipped, manual, scheduled
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#8b008b;font-weight:700>if</span> status == <span style=color:#cd5555>&#34;success&#34;</span> ||
</span></span><span style=display:flex><span>      status == <span style=color:#cd5555>&#34;failed&#34;</span> ||
</span></span><span style=display:flex><span>      status == <span style=color:#cd5555>&#34;canceled&#34;</span> ||
</span></span><span style=display:flex><span>      status == <span style=color:#cd5555>&#34;skipped&#34;</span> {
</span></span><span style=display:flex><span>      l.<span style=color:#008b45>Info</span>(<span style=color:#cd5555>&#34;pipeline completed&#34;</span>, <span style=color:#cd5555>&#34;status&#34;</span>, status)
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>if</span> p.IsGitHub {
</span></span><span style=display:flex><span>        <span style=color:#228b22>// update status
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>        <span style=color:#8b008b;font-weight:700>if</span> err := gh.<span style=color:#008b45>SetOutput</span>(<span style=color:#8b008b;font-weight:700>map</span>[<span style=color:#00688b;font-weight:700>string</span>]<span style=color:#00688b;font-weight:700>string</span>{<span style=color:#cd5555>&#34;status&#34;</span>: status}); err != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#8b008b;font-weight:700>return</span> err
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span> <span style=color:#8b008b;font-weight:700>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Take a look at the code above. Are there any areas that can be optimized? The main issue is that when using <code>time.After</code> with a for loop, the overall execution time is recalculated each time <code>ticker.C</code> triggers, which is not our intention.</p><p>We can optimize the code by using <code>context</code>, which makes it easier to control the execution time of the program.。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#228b22>// Create a new context with a timeout
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>ctx, cancel := context.<span style=color:#008b45>WithTimeout</span>(context.<span style=color:#008b45>Background</span>(), p.Timeout)
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>defer</span> <span style=color:#008b45>cancel</span>()
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>for</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>case</span> &lt;-ctxTimeout.<span style=color:#008b45>Done</span>():
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>return</span> errors.<span style=color:#008b45>New</span>(<span style=color:#cd5555>&#34;timeout waiting for pipeline to complete after &#34;</span> + p.Timeout.<span style=color:#008b45>String</span>())
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>case</span> &lt;-ticker.C:
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>if</span> ctxTimeout.<span style=color:#008b45>Err</span>() != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>if</span> p.IsGitHub {
</span></span><span style=display:flex><span>        <span style=color:#228b22>// update status
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>        <span style=color:#8b008b;font-weight:700>if</span> err := gh.<span style=color:#008b45>SetOutput</span>(<span style=color:#8b008b;font-weight:700>map</span>[<span style=color:#00688b;font-weight:700>string</span>]<span style=color:#00688b;font-weight:700>string</span>{<span style=color:#cd5555>&#34;status&#34;</span>: status}); err != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#8b008b;font-weight:700>return</span> err
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span> ctxTimeout.<span style=color:#008b45>Err</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=screenshot>Screenshot</h2><p>The result of executing through GitHub Action can be found in the <a href=https://github.com/appleboy/gitlab-ci-action>GitHub Repo</a></p><p><img src=/images/2024-11-16/screenshot.png alt=gitlab-ci-action></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-36>36</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:17:42.079Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline created&#34;</span> <span style=color:#00688b>project_id</span>=***
</span></span><span style=display:flex><span><span style=color:#00688b>pipeline_id</span>=<span style=color:#b452cd>1505619557</span> <span style=color:#00688b>pipeline_sha</span>=a36503d3ba12e7832752e17c213efd09000fac03
</span></span><span style=display:flex><span><span style=color:#00688b>pipeline_ref</span>=main <span style=color:#00688b>pipeline_status</span>=created
</span></span><span style=display:flex><span><span style=color:#00688b>pipeline_web_url</span>=https://gitlab.com/appleboy/test/-/pipelines/1505619557
</span></span><span style=display:flex><span><span style=color:#00688b>pipeline_created_at</span>=2024-10-21T15:17:41.767Z
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:17:42.079Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;waiting for pipeline to complete&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>timeout</span>=1h0m0s
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:17:47.237Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:17:52.212Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:17:57.209Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:02.219Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:07.217Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:12.222Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:17.210Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:22.235Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:27.219Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:32.241Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:37.395Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:42.219Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:47.229Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:52.211Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:18:57.225Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:02.219Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:07.247Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:12.283Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:17.254Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:22.200Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:27.208Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:32.213Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:37.244Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:42.256Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:47.219Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:52.217Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:19:57.234Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:20:02.226Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=running <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:20:07.283Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline status&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=success <span style=color:#00688b>triggered_by</span>=<span style=color:#cd5555>&#34;Bo-Yi Wu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00688b>time</span>=2024-10-21T15:20:07.283Z <span style=color:#00688b>level</span>=INFO <span style=color:#00688b>msg</span>=<span style=color:#cd5555>&#34;pipeline completed&#34;</span> <span style=color:#00688b>project_id</span>=*** <span style=color:#00688b>status</span>=success
</span></span></code></pre></td></tr></table></div></div><h2 id=simple-example>Simple Example</h2><p>How can you reproduce the issue described above? Refer to the code below::</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-30>30</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b008b;font-weight:700>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#cd5555>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>main</span>() {
</span></span><span style=display:flex><span>  output := <span style=color:#658b00>make</span>(<span style=color:#8b008b;font-weight:700>chan</span> <span style=color:#00688b;font-weight:700>int</span>, <span style=color:#b452cd>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>go</span> <span style=color:#8b008b;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>for</span> i := <span style=color:#b452cd>0</span>; i &lt; <span style=color:#b452cd>30</span>; i++ {
</span></span><span style=display:flex><span>      output &lt;- i
</span></span><span style=display:flex><span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>100</span> * time.Millisecond)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>  <span style=color:#8b008b;font-weight:700>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>case</span> val := &lt;-output:
</span></span><span style=display:flex><span>      <span style=color:#228b22>// simulate slow consumer
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>500</span> * time.Millisecond)
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;output:&#34;</span>, val)
</span></span><span style=display:flex><span>    <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#8b008b;font-weight:700>case</span> &lt;-time.<span style=color:#008b45>After</span>(<span style=color:#b452cd>1</span> * time.Second):
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;timeout&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>This way you can replicate the issue above. By using <code>time.After</code> to set the timeout duration, you can simulate the issue above.</p><h3 id=solution-01>Solution 01</h3><p>Move <code>time.After</code> outside the for loop to avoid recalculating the overall execution time each time <code>ticker.C</code> triggers.</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-37>37</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b008b;font-weight:700>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#cd5555>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>main</span>() {
</span></span><span style=display:flex><span>  output := <span style=color:#658b00>make</span>(<span style=color:#8b008b;font-weight:700>chan</span> <span style=color:#00688b;font-weight:700>int</span>, <span style=color:#b452cd>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>go</span> <span style=color:#8b008b;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>for</span> i := <span style=color:#b452cd>0</span>; i &lt; <span style=color:#b452cd>30</span>; i++ {
</span></span><span style=display:flex><span>      output &lt;- i
</span></span><span style=display:flex><span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>100</span> * time.Millisecond)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  timeout := time.<span style=color:#008b45>After</span>(<span style=color:#b452cd>1</span> * time.Second)
</span></span><span style=display:flex><span>  <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>  <span style=color:#8b008b;font-weight:700>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>case</span> val := &lt;-output:
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>case</span> &lt;-timeout:
</span></span><span style=display:flex><span>        <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;reached timeout, but still have data to process&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#8b008b;font-weight:700>return</span>
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>default</span>:
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#228b22>// simulate slow consumer
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>500</span> * time.Millisecond)
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;output:&#34;</span>, val)
</span></span><span style=display:flex><span>    <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#8b008b;font-weight:700>case</span> &lt;-timeout:
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;timeout&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-02>Solution 02</h3><p>Optimize the code using <code>context</code>, which makes it easier to control the execution time of the program.</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-37>37</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b008b;font-weight:700>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#cd5555>&#34;context&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cd5555>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>main</span>() {
</span></span><span style=display:flex><span>  output := <span style=color:#658b00>make</span>(<span style=color:#8b008b;font-weight:700>chan</span> <span style=color:#00688b;font-weight:700>int</span>, <span style=color:#b452cd>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>go</span> <span style=color:#8b008b;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>for</span> i := <span style=color:#b452cd>0</span>; i &lt; <span style=color:#b452cd>30</span>; i++ {
</span></span><span style=display:flex><span>      output &lt;- i
</span></span><span style=display:flex><span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>100</span> * time.Millisecond)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ctx, cancel := context.<span style=color:#008b45>WithTimeout</span>(context.<span style=color:#008b45>Background</span>(), <span style=color:#b452cd>1</span>*time.Second)
</span></span><span style=display:flex><span>  <span style=color:#8b008b;font-weight:700>defer</span> <span style=color:#008b45>cancel</span>()
</span></span><span style=display:flex><span>  <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>  <span style=color:#8b008b;font-weight:700>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>case</span> val := &lt;-output:
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>if</span> ctx.<span style=color:#008b45>Err</span>() != <span style=color:#8b008b;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;reached timeout, but still have data to process&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#8b008b;font-weight:700>return</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#228b22>// simulate slow consumer
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>      time.<span style=color:#008b45>Sleep</span>(<span style=color:#b452cd>500</span> * time.Millisecond)
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;output:&#34;</span>, val)
</span></span><span style=display:flex><span>    <span style=color:#228b22>// how to fix the timeout issue?
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#8b008b;font-weight:700>case</span> &lt;-ctx.<span style=color:#008b45>Done</span>():
</span></span><span style=display:flex><span>      <span style=color:#658b00>println</span>(<span style=color:#cd5555>&#34;timeout&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#8b008b;font-weight:700>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion</h2><p>Using the GitLab API to automate CI/CD processes is a great way to learn, as it helps you understand how CI/CD processes work and allows you to trigger CI/CD processes through code, making it easier to integrate into your projects. The Go language is an excellent language to learn, and implementing a small project in Go helps you become familiar with its features more quickly. This article aims to help those who want to learn the Go language understand the integration of <a href=https://go.dev/ref/spec#Select_statements>select</a> and <a href=https://pkg.go.dev/context>context</a>, and how to use context to optimize code.</p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f&amp;text=Learning%20Go%20Language%20with%20GitLab%20API&amp;via=appleboy" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f&amp;title=Learning%20Go%20Language%20with%20GitLab%20API" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f&amp;title=Learning%20Go%20Language%20with%20GitLab%20API" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f&amp;title=Learning%20Go%20Language%20with%20GitLab%20API" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.wu-boy.com%2f2024%2f11%2flearning-go-language-with-gitlab-api-en%2f&amp;description=Learning%20Go%20Language%20with%20GitLab%20API" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://blog.wu-boy.com/2024/11/learning-go-language-with-gitlab-api-zh-tw/ data-toggle=tooltip data-placement=top title="使用 GitLab API 學習 Go 語言">&larr; Previous Post</a></li><li class=next><a href=https://blog.wu-boy.com/2025/01/git-software-development-guide-key-to-improving-team-collaboration-zh-tw/ data-toggle=tooltip data-placement=top title="Git 軟體開發指南：提高團隊協作的關鍵">Next Post &rarr;</a></li></ul><div class=disqus-comments><button id=show-comments class="btn btn-default" type=button>Show <span class=disqus-comment-count data-disqus-url=https://blog.wu-boy.com/2024/11/learning-go-language-with-gitlab-api-en>comments</span></button><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.url="https://blog.wu-boy.com/2024/11/learning-go-language-with-gitlab-api-en"}</script></div></div></div></div><footer class=post-footer><div class=container><div class=row><div class="col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:appleboy.tw@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/appleboy46 title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/appleboy title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://gitlab.com/appleboy title=GitLab><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-gitlab fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://bitbucket.org/appleboy title=Bitbucket><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-bitbucket fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/appleboy title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/appleboy title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.youtube.com/channel/UCLCZJ9d_I7UJP2bpXpge8KA title=Youtube><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-youtube fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://blog.wu-boy.com>Appleboy</a>
&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=https://blog.wu-boy.com/>小惡魔 - AppleBOY</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.130.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://blog.wu-boy.com/js/main.js></script><script>(function(){var t,n="003841896160749976666:l9i5hqttpqi",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="appleboy48";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//appleboy48.disqus.com/count.js async></script><div class=back-to-top id=back-to-top><i class="fas fa-angle-double-up"></i></div></body></html>