<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>graceful shutdown on 小惡魔 - AppleBOY</title><link>https://blog.wu-boy.com/tags/graceful-shutdown/</link><description>Recent content in graceful shutdown on 小惡魔 - AppleBOY</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><managingEditor>appleboy.tw@gmail.com (Appleboy)</managingEditor><webMaster>appleboy.tw@gmail.com (Appleboy)</webMaster><lastBuildDate>Sun, 17 Apr 2022 07:41:33 +0800</lastBuildDate><atom:link href="https://blog.wu-boy.com/tags/graceful-shutdown/feed.xml" rel="self" type="application/rss+xml"/><item><title>Go 語言實作 Graceful Shutdown 套件</title><link>https://blog.wu-boy.com/2022/04/new-package-graceful-shutdown-in-golang/</link><pubDate>Sun, 17 Apr 2022 07:41:33 +0800</pubDate><author>appleboy.tw@gmail.com (Appleboy)</author><guid>https://blog.wu-boy.com/2022/04/new-package-graceful-shutdown-in-golang/</guid><description>&lt;p>&lt;img src="https://i.imgur.com/D5FfhY5.png" alt="background job 01">&lt;/p>
&lt;p>目前團隊所有服務皆用 &lt;a href="https://go.dev">Go 語言&lt;/a>打造，而如何優雅的重新啟動服務，避免正在跑的工作執行到一半就被關閉，是一個很中要的議題。故實作了簡易 Graceful Shutdown 套件，讓每個服務都可以支援此功能，如果不知道什麼是 Graceful Shutdown 的朋友們，可以參考這篇『 &lt;a href="https://blog.wu-boy.com/2020/02/what-is-graceful-shutdown-in-golang/">[Go 教學] 什麼是 graceful shutdown?&lt;/a>』，本篇跟大家介紹一個好用的套件『&lt;a href="https://github.com/appleboy/graceful">appleboy/graceful&lt;/a>』，使用後。不用再擔心背景的服務沒完成就被關閉，不只是背景的工作需要處理，在關閉服務前，開發者也要確保部分工作要在關閉服務前才執行，像是關閉 Database 及 Redis 連線。&lt;/p></description></item><item><title>NSQ Consumers 處理 Graceful Shutdown 技巧</title><link>https://blog.wu-boy.com/2021/09/graceful-shutdown-with-nsq-consumers/</link><pubDate>Sun, 19 Sep 2021 14:50:42 +0800</pubDate><author>appleboy.tw@gmail.com (Appleboy)</author><guid>https://blog.wu-boy.com/2021/09/graceful-shutdown-with-nsq-consumers/</guid><description>&lt;p>&lt;img src="https://i.imgur.com/i98snGt.png" alt="Imgur">&lt;/p>
&lt;p>&lt;a href="https://nsq.io/">NSQ&lt;/a> 是一套即時分散式處理消息平台，目的在於提供大量的訊息傳遞，團隊可以依據不同的任務來設計分散式架構去消化大量的訊息。而我在最近開發了一套開源項目 &lt;a href="https://github.com/golang-queue/queue">golang-queue/queue&lt;/a>，這套詳細的資訊會再開另一篇進行討論，簡單來說這個套件可以讓開發者使用在單機的 Producer 及 Consumer 架構，使用的就是 &lt;a href="https://golang.org">Go 語言&lt;/a>的 Goroutine 及 Channel，又或者直接搭配 &lt;a href="https://nsq.io/">NSQ&lt;/a>, &lt;a href="https://nats.io/">NATs&lt;/a> 或 &lt;a href="https://redis.io/topics/pubsub">Redis Pub/Sub&lt;/a> 第三方的系統取代內建的 Channel 機制。而本篇會講在整合 NSQ 要處理 &lt;a href="https://blog.wu-boy.com/2020/02/what-is-graceful-shutdown-in-golang/">Graceful Shutdown&lt;/a> 所遇到的問題跟解決方式。&lt;/p></description></item><item><title>用 docker-compose 優雅關閉服務</title><link>https://blog.wu-boy.com/2021/06/graceful-stop-service-using-docker-compose-in-golang/</link><pubDate>Sun, 20 Jun 2021 10:28:17 +0800</pubDate><author>appleboy.tw@gmail.com (Appleboy)</author><guid>https://blog.wu-boy.com/2021/06/graceful-stop-service-using-docker-compose-in-golang/</guid><description>&lt;p>&lt;img src="https://lh3.googleusercontent.com/jsocHCR9A9yEfDVUTrU0m42_aHhTEVDGW5p5PsQSx7GSlkt3gLjohfXH3S7P7p982332ruU_e-EtW0LwmiuZjvN65VIcyME-zE35C6EM0IV1nqY6KoNw3dwW2djjid3F-T5YgnJothA=w1920-h1080" alt="logo">&lt;/p>
&lt;p>大家應該遇過如果服務還有工作還沒處理完，服務要進行更新，需要等到全部工作處理完成才可以將服務的停止，而當服務收到關閉通知信號時，第一要先停止接受 Job 任務，接著等待 Worker 將手上 Job 處理完畢後，才停止服務，接著更新再上線。而這狀況怎麼透過 docker-compose 來處理停止服務，這就是本篇的重點。文章內會用 &lt;a href="https://golang.org/">Go 語言&lt;/a>當教學範例，如何接受 &lt;a href="https://www.docker.com/">Docker&lt;/a> 傳來的 Signal 訊號，接受訊號後該如何處理，及如何設定 docker-compose 的 YAML 檔案確保所有的工作都可以正常執行完畢。&lt;/p>
&lt;p>之前已經有寫過幾篇關於 Graceful Shutdown 教學文章，大家有興趣可以先閱讀底下教學連結資訊，而本篇最主要是紀錄在如何用 docker 指令優雅關閉容器服務，尤其是關閉服務前，可以讓原本服務內的工作可以正常做完，才正式關閉。在本文開始前，先將 &lt;a href="https://www.docker.com/">docker&lt;/a> 及 &lt;a href="https://docs.docker.com/compose/compose-file/">docker-compose&lt;/a> 版本資訊貼出來，避免有資訊的落差，畢竟 docker-compose 在不同版本之間有不同的設定方式。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://blog.wu-boy.com/2020/02/graceful-shutdown-using-docker-compose-with-rolling-update/">[Go 教學] graceful shutdown 搭配 docker-compose 實現 rolling update&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.wu-boy.com/2020/02/graceful-shutdown-with-multiple-workers/">[Go 教學] graceful shutdown with multiple workers&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>如何取得上傳進度條 progress bar 相關數據及實作 Graceful Shutdown</title><link>https://blog.wu-boy.com/2021/05/graceful-shutdown-with-progress-bar-in-golang/</link><pubDate>Fri, 21 May 2021 04:52:17 +0000</pubDate><author>appleboy.tw@gmail.com (Appleboy)</author><guid>https://blog.wu-boy.com/2021/05/graceful-shutdown-with-progress-bar-in-golang/</guid><description>&lt;p>&lt;img src="https://lh3.googleusercontent.com/ASkclquxfpPTlJ_QWnhZjB5katrz18NyK4zt2w47UM8gS71MCjWodDoGp50nHRyeQx8MfbJJbwWjfIWCoKbZYLkec7a-FqMEw-r9Lh3U8XGAuwEqWa3DVMB2lkhdgMQUI1IMiKWL5Ss=w1920-h1080" alt="">&lt;/p>
&lt;p>由於專案需求，需要開發一套 CLI 工具，讓 User 可以透過 CLI 上傳大檔案來進行 Model Training，請參考上面的流程圖。首先第一步驟會先跟 API Server 驗證使用者，驗證完畢就開始上傳資料到 &lt;a href="https://aws.amazon.com/tw/s3/">AWS S3&lt;/a> 或其他 Storage 空間，除了上傳過程需要在 CLI 顯示目前進度，另外也需要將目前上傳的進度 (速度, 進度及剩餘時間) 都上傳到 API Server，最後在 Web UI 介面透過 &lt;a href="https://www.apollographql.com/docs/react/data/subscriptions/">GraphQL Subscription&lt;/a> 讓使用者可以即時看到上傳進度數據。&lt;/p>
&lt;p>而 CLI 上傳進度部分，我們選用了一套開源套件 &lt;a href="https://github.com/cheggaaa/pb">cheggaaa/pb&lt;/a>，相信有在寫 &lt;a href="https://golang.org">Go 語言&lt;/a>都並不會陌生。而此套件雖然可以幫助在 Terminal 顯示進度條，但是有些接口是沒有提供的，像是即時速度，上傳進度及剩餘時間。本篇教大家如何實作這些數據，及分享過程會遇到相關問題。&lt;/p></description></item><item><title>[Go 教學] 什麼是 graceful shutdown?</title><link>https://blog.wu-boy.com/2020/02/what-is-graceful-shutdown-in-golang/</link><pubDate>Sat, 08 Feb 2020 03:29:08 +0000</pubDate><author>appleboy.tw@gmail.com (Appleboy)</author><guid>https://blog.wu-boy.com/2020/02/what-is-graceful-shutdown-in-golang/</guid><description>&lt;p>&lt;a href="https://lh3.googleusercontent.com/jsocHCR9A9yEfDVUTrU0m42_aHhTEVDGW5p5PsQSx7GSlkt3gLjohfXH3S7P7p982332ruU_e-EtW0LwmiuZjvN65VIcyME-zE35C6EM0IV1nqY6KoNw3dwW2djjid3F-T5YgnJothA=w1920-h1080" title="golang logo">&lt;img src="https://lh3.googleusercontent.com/jsocHCR9A9yEfDVUTrU0m42_aHhTEVDGW5p5PsQSx7GSlkt3gLjohfXH3S7P7p982332ruU_e-EtW0LwmiuZjvN65VIcyME-zE35C6EM0IV1nqY6KoNw3dwW2djjid3F-T5YgnJothA=w1920-h1080" alt="golang logo" title="golang logo">&lt;/a>&lt;/p>
&lt;p>我們該如何升級 Web 服務，你會說很簡單啊，只要關閉服務，上程式碼，再開啟服務即可，可是很多時候開發者可能沒有想到現在服務上面是否有正在處理的資料，像是購物車交易？也或者是說背景有正在處理重要的事情，如果強制關閉服務，就會造成下次啟動時會有一些資料上的差異，那該如何優雅地關閉服務，這就是本篇的重點了。底下先透過簡單的 gin http 服務範例介紹簡單的 web 服務&lt;/p></description></item></channel></rss>