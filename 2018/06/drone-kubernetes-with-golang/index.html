<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Drone 搭配 Kubernetes 部署 Go 語言項目 - 小惡魔 - AppleBOY</title>
<meta name=description content="
在之前寫過一篇『Drone 搭配 Kubernetes 升級應用程式版本』，裡面內容最主要介紹 honestbee 撰寫的 drone 外掛: drone-kubernetes，但是此外掛並非用 Go 語言所撰寫，而是用 Shell Script 透過 kubectl set image 方式來更新專案項目，但是這邊會有幾個缺點，第一點就是假設在 Develop 環境永遠都是吃 master 分支，也就是讀取 Image 的 latest 標籤，這時候此外掛就無法作用，第二點此外掛無法讀取 kubernetes YAML 檔案，假設專案要修正一個 ENV 值，此外掛也無法及時更新。綜合這兩點因素，只好捨棄此外掛，而本篇會帶給大家另一個用 Go 語言所撰寫的外掛，是由 @Sh4d1 所開發的項目，用法相當容易，底下會一步一步教大家如何部署 Go 語言項目。">
<meta name=author content="Appleboy"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"小惡魔 - AppleBOY","url":"https:\/\/blog.wu-boy.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.wu-boy.com"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/blog.wu-boy.com","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/blog.wu-boy.com\/2018\/06\/drone-kubernetes-with-golang\/","name":"Drone 搭配 kubernetes 部署 go 語言項目"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"appleboy"},"headline":"Drone 搭配 Kubernetes 部署 Go 語言項目","description":"\n在之前寫過一篇『Drone 搭配 Kubernetes 升級應用程式版本』，裡面內容最主要介紹 honestbee 撰寫的 drone 外掛: drone-kubernetes，但是此外掛並非用 Go 語言所撰寫，而是用 Shell Script 透過 kubectl set image 方式來更新專案項目，但是這邊會有幾個缺點，第一點就是假設在 Develop 環境永遠都是吃 master 分支，也就是讀取 Image 的 latest 標籤，這時候此外掛就無法作用，第二點此外掛無法讀取 kubernetes YAML 檔案，假設專案要修正一個 ENV 值，此外掛也無法及時更新。綜合這兩點因素，只好捨棄此外掛，而本篇會帶給大家另一個用 Go 語言所撰寫的外掛，是由 @Sh4d1 所開發的項目，用法相當容易，底下會一步一步教大家如何部署 Go 語言項目。\n","inLanguage":"en","wordCount":677,"datePublished":"2018-06-05T02:36:11","dateModified":"2018-06-05T02:36:11","image":"https:\/\/lh3.googleusercontent.com\/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080","keywords":["drone, golang, kubernetes"],"mainEntityOfPage":"https:\/\/blog.wu-boy.com\/2018\/06\/drone-kubernetes-with-golang\/","publisher":{"@type":"Organization","name":"https:\/\/blog.wu-boy.com","logo":{"@type":"ImageObject","url":"https:\/\/lh3.googleusercontent.com\/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080","height":60,"width":60}}}</script>
<meta property="og:title" content="Drone 搭配 Kubernetes 部署 Go 語言項目">
<meta property="og:description" content="
在之前寫過一篇『Drone 搭配 Kubernetes 升級應用程式版本』，裡面內容最主要介紹 honestbee 撰寫的 drone 外掛: drone-kubernetes，但是此外掛並非用 Go 語言所撰寫，而是用 Shell Script 透過 kubectl set image 方式來更新專案項目，但是這邊會有幾個缺點，第一點就是假設在 Develop 環境永遠都是吃 master 分支，也就是讀取 Image 的 latest 標籤，這時候此外掛就無法作用，第二點此外掛無法讀取 kubernetes YAML 檔案，假設專案要修正一個 ENV 值，此外掛也無法及時更新。綜合這兩點因素，只好捨棄此外掛，而本篇會帶給大家另一個用 Go 語言所撰寫的外掛，是由 @Sh4d1 所開發的項目，用法相當容易，底下會一步一步教大家如何部署 Go 語言項目。">
<meta property="og:image" content="https://lh3.googleusercontent.com/jsocHCR9A9yEfDVUTrU0m42_aHhTEVDGW5p5PsQSx7GSlkt3gLjohfXH3S7P7p982332ruU_e-EtW0LwmiuZjvN65VIcyME-zE35C6EM0IV1nqY6KoNw3dwW2djjid3F-T5YgnJothA=w1920-h1080">
<meta property="og:url" content="https://blog.wu-boy.com/2018/06/drone-kubernetes-with-golang/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="小惡魔 - AppleBOY">
<meta name=twitter:title content="Drone 搭配 Kubernetes 部署 Go 語言項目">
<meta name=twitter:description content="
在之前寫過一篇『Drone 搭配 Kubernetes 升級應用程式版本』，裡面內容最主要介紹 honestbee 撰寫的 drone 外掛: drone-kubernetes，但是此外掛並非用 Go 語言所撰寫，而是用 Shell Script 透過 kubectl set image 方式來更新專案項目，但是這邊會有幾個缺點，第一點就是假設在 Develop 環境永遠都是吃 master 分 …">
<meta name=twitter:image content="https://lh3.googleusercontent.com/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@appleboy">
<meta name=twitter:creator content="@appleboy">
<link href=https://i.imgur.com/PpOg8Dz.jpg rel=icon type=image/x-icon>
<meta name=generator content="Hugo 0.90.1"><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css>
<link rel=stylesheet href=https://blog.wu-boy.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.wu-boy.com/css/syntax.css><link rel=stylesheet href=https://blog.wu-boy.com/css/codeblock.css>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-5766319-6','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://blog.wu-boy.com>小惡魔 - AppleBOY</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title="Youtube 頻道" href=http://bit.ly/youtube-boy><i class="fab fa-youtube"></i> Youtube 頻道</a>
</li>
<li class=navlinks-container>
<a class=navlinks-parent><i class="fas fa-video"></i> 線上課程</a>
<div class=navlinks-children>
<a href=/golang-online-course/> Go 語言基礎實戰</a>
<a href=/docker-course/> Docker 容器開發實戰</a>
<a href=/drone-devops/> 一天學會 DevOps 自動化流程</a>
</div>
</li>
<li>
<a title=歷年文章 href=/archives/><i class="fas fa-sitemap fa-lg"></i> 歷年文章</a>
</li>
<li>
<a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none>
<span class="hidden-sm hidden-md hidden-lg">Search</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span>
</a>
</li>
</ul>
</div>
<div class=avatar-container>
<div class=avatar-img-border>
<a title="小惡魔 - AppleBOY" href=https://blog.wu-boy.com>
<img class=avatar-img src="https://lh3.googleusercontent.com/Kq9CxHZWopKj__EgF_BpzLv8FhwvDkc0iacrl9V5IJjpr-dZ7Y5O-Vc1i9FhGQ8gHTdKeBisG_1ie1IONQXmK0a3myyl_BNouP76CLHGHRzsPPRgRF3RiKYqOkdS86mZOIu7KYFTUio=w1920-h1080" alt="小惡魔 - AppleBOY">
</a>
</div>
</div>
</div>
</nav>
<div id=modalSearch class="modal fade" role=dialog>
<div class=modal-dialog>
<div class=modal-content>
<div class=modal-header>
<button type=button class=close data-dismiss=modal>&#215;</button>
<h4 class=modal-title>Search 小惡魔 - AppleBOY</h4>
</div>
<div class=modal-body>
<gcse:search></gcse:search>
</div>
<div class=modal-footer>
<button type=button class="btn btn-default" data-dismiss=modal>Close</button>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-md-10 col-md-offset-1">
<div class=post-heading>
<h1>Drone 搭配 Kubernetes 部署 Go 語言項目</h1>
<span class=post-meta>
<i class="fas fa-calendar"></i>&nbsp;Posted on June 5, 2018
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;4&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;677&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;appleboy
</span>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-md-10 col-md-offset-1">
<aside class=toc-article>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#github-工作流程及部署>GitHub 工作流程及部署</a></li>
<li><a href=#準備-go-項目>準備 Go 項目</a></li>
<li><a href=#上傳容器到-dockerhub>上傳容器到 DockerHub</a></li>
<li><a href=#部署更新-kubernetes>部署更新 Kubernetes</a></li>
<li><a href=#影片簡介>影片簡介</a></li>
<li><a href=#心得>心得</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
<article role=main class=blog-post>
<p><a href=https://www.flickr.com/photos/appleboy/27678088297/in/dateposted-public/ title="Screen Shot 2018-06-04 at 9.19.46 AM"><img src="https://i1.wp.com/farm2.staticflickr.com/1738/27678088297_1c6fe64e86_z.jpg?w=840&ssl=1" alt="Screen Shot 2018-06-04 at 9.19.46 AM" data-recalc-dims=1></a></p>
<p>在之前寫過一篇『<a href=https://blog.wu-boy.com/2017/10/upgrade-kubernetes-container-using-drone/>Drone 搭配 Kubernetes 升級應用程式版本</a>』，裡面內容最主要介紹 <a href=https://github.com/honestbee>honestbee</a> 撰寫的 <a href=https://drone.io>drone</a> 外掛: <a href=https://github.com/honestbee/drone-kubernetes>drone-kubernetes</a>，但是此外掛並非用 <a href=https://golang.org>Go 語言</a>所撰寫，而是用 Shell Script 透過 <code>kubectl set image</code> 方式來更新專案項目，但是這邊會有幾個缺點，第一點就是假設在 Develop 環境永遠都是吃 master 分支，也就是讀取 Image 的 <code>latest</code> 標籤，這時候此外掛就無法作用，第二點此外掛無法讀取 kubernetes YAML 檔案，假設專案要修正一個 ENV 值，此外掛也無法及時更新。綜合這兩點因素，只好捨棄此外掛，而本篇會帶給大家另一個用 Go 語言所撰寫的外掛，是由 <a href=https://github.com/Sh4d1>@Sh4d1</a> 所開發的<a href=https://github.com/Sh4d1/drone-kubernetes/>項目</a>，用法相當容易，底下會一步一步教大家如何部署 Go 語言項目。</p>
<h2 id=github-工作流程及部署>GitHub 工作流程及部署</h2>
<p><a href=https://www.flickr.com/photos/appleboy/42549008141/in/dateposted-public/ title="Screen Shot 2018-06-04 at 9.44.15 AM"><img src="https://i0.wp.com/farm2.staticflickr.com/1737/42549008141_e035c63057_z.jpg?w=840&ssl=1" alt="Screen Shot 2018-06-04 at 9.44.15 AM" data-recalc-dims=1></a></p>
<p>團隊只會有兩種環境，一種是 Staging 另一種則是 Production，而前者是根據只要 master 分支有變動，則會更新 Staging，而後者則需要下 Tag 才會正式部署到 Production，在 Drone 預設值內，是不開啟 Tag 事件，所以需自行到後台打開 (如下圖)，未來可以透過 drone-cli 用 command 方式打開，目前<a href=https://github.com/drone/drone-cli/pull/90>此功能</a>正在 Review 中。</p>
<p><a href=https://www.flickr.com/photos/appleboy/41647040945/in/dateposted-public/ title=Snip20180604_6><img src="https://i0.wp.com/farm2.staticflickr.com/1730/41647040945_0b938ab53a_z.jpg?w=840&ssl=1" alt=Snip20180604_6 data-recalc-dims=1></a></p>
<p>底下會來一步一步教大家如何設定 Drone。</p>
<h2 id=準備-go-項目>準備 Go 項目</h2>
<p>本篇會用 Go 語言寫個小型 Http 服務，來證明使用 tag 事件及 master 分支都可以正確部署，底下先看看 Go 的程式碼:</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=color:#8b008b;font-weight:700>package</span> main

<span style=color:#8b008b;font-weight:700>import</span> (
    <span style=color:#cd5555>&#34;log&#34;</span>
    <span style=color:#cd5555>&#34;net/http&#34;</span>
    <span style=color:#cd5555>&#34;os&#34;</span>
    <span style=color:#cd5555>&#34;strings&#34;</span>
)

<span style=color:#8b008b;font-weight:700>var</span> version = <span style=color:#cd5555>&#34;master&#34;</span>

<span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>showVersion</span>(w http.ResponseWriter, r *http.Request) {
    log.<span style=color:#008b45>Println</span>(version)
    w.<span style=color:#008b45>Write</span>([]<span style=color:#658b00>byte</span>(version))
}

<span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>sayHello</span>(w http.ResponseWriter, r *http.Request) {
    message := r.URL.Path
    message = strings.<span style=color:#008b45>TrimPrefix</span>(message, <span style=color:#cd5555>&#34;/&#34;</span>)
    message = <span style=color:#cd5555>&#34;Hello, drone got the message: &#34;</span> + message
    log.<span style=color:#008b45>Println</span>(message)
    w.<span style=color:#008b45>Write</span>([]<span style=color:#658b00>byte</span>(message))
}

<span style=color:#8b008b;font-weight:700>func</span> <span style=color:#008b45>main</span>() {
    <span style=color:#228b22>// use PORT environment variable, or default to 8080
</span><span style=color:#228b22></span>    port := <span style=color:#cd5555>&#34;8080&#34;</span>
    <span style=color:#8b008b;font-weight:700>if</span> fromEnv := os.<span style=color:#008b45>Getenv</span>(<span style=color:#cd5555>&#34;PORT&#34;</span>); fromEnv != <span style=color:#cd5555>&#34;&#34;</span> {
        port = fromEnv
    }
    http.<span style=color:#008b45>HandleFunc</span>(<span style=color:#cd5555>&#34;/version&#34;</span>, showVersion)
    http.<span style=color:#008b45>HandleFunc</span>(<span style=color:#cd5555>&#34;/&#34;</span>, sayHello)
    log.<span style=color:#008b45>Println</span>(<span style=color:#cd5555>&#34;Listen server on &#34;</span> + port + <span style=color:#cd5555>&#34; port&#34;</span>)
    <span style=color:#8b008b;font-weight:700>if</span> err := http.<span style=color:#008b45>ListenAndServe</span>(<span style=color:#cd5555>&#34;:&#34;</span>+port, <span style=color:#8b008b;font-weight:700>nil</span>); err != <span style=color:#8b008b;font-weight:700>nil</span> {
        log.<span style=color:#008b45>Fatal</span>(err)
    }
}
</code></pre></td></tr></table>
</div>
</div><p>從上面程式可以看到，在編譯 Go 語言專案時，可以從外部帶入 version 變數，證明目前的 App 版本。請參考 Makefile 內的</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-makefile data-lang=makefile><span style=color:#008b45>build</span>:
<span style=color:#a61717;background-color:#e3d2d2>ifneq</span> <span style=color:#a61717;background-color:#e3d2d2>(</span><span style=color:#8b008b;font-weight:700>$(</span><span style=color:#00688b>DRONE_TAG</span><span style=color:#8b008b;font-weight:700>)</span><span style=color:#a61717;background-color:#e3d2d2>,)</span>
    <span style=color:#a61717;background-color:#e3d2d2>go</span> <span style=color:#a61717;background-color:#e3d2d2>build</span> <span style=color:#a61717;background-color:#e3d2d2>-v</span> <span style=color:#a61717;background-color:#e3d2d2>-ldflags</span> <span style=color:#cd5555>&#34;-X main.version=$(DRONE_TAG)&#34;</span> <span style=color:#a61717;background-color:#e3d2d2>-a</span> <span style=color:#a61717;background-color:#e3d2d2>-o</span> <span style=color:#a61717;background-color:#e3d2d2>release/linux/amd64/hello</span>
<span style=color:#a61717;background-color:#e3d2d2>else</span>
    <span style=color:#a61717;background-color:#e3d2d2>go</span> <span style=color:#a61717;background-color:#e3d2d2>build</span> <span style=color:#a61717;background-color:#e3d2d2>-v</span> <span style=color:#a61717;background-color:#e3d2d2>-ldflags</span> <span style=color:#cd5555>&#34;-X main.version=$(DRONE_COMMIT)&#34;</span> <span style=color:#a61717;background-color:#e3d2d2>-a</span> <span style=color:#a61717;background-color:#e3d2d2>-o</span> <span style=color:#a61717;background-color:#e3d2d2>release/linux/amd64/hello</span>
<span style=color:#a61717;background-color:#e3d2d2>endif</span>
</code></pre></td></tr></table>
</div>
</div><p>只要是 master 分支的 commit，就會執行 <code>-X main.version=$(DRONE_COMMIT)</code>，如果是 push tag 到伺服器，則會執行 <code>-X main.version=$(DRONE_TAG)</code>。最後看看 Drone 如何編譯</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#8b008b;font-weight:700>pipeline</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>build_linux_amd64</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>golang:1.10<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>group</span>:<span style=color:#bbb> </span>build<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>environment</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- GOOS=linux<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- GOARCH=amd64<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- CGO_ENABLED=0<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>commands</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- cd example19-deploy-with-kubernetes &amp;&amp; make build<span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>記得將 <code>GOOS</code>, <code>GOARCH</code> 和 <code>CGO_ENABLED</code> 設定好。</p>
<h2 id=上傳容器到-dockerhub>上傳容器到 DockerHub</h2>
<p>上一個步驟可以編譯出 linux 的二進制檔案，這時候就可以直接放到容器內直接執行:</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-dockerfile data-lang=dockerfile><span style=color:#8b008b;font-weight:700>FROM</span><span style=color:#cd5555> plugins/base:multiarch</span><span style=color:#a61717;background-color:#e3d2d2>
</span><span style=color:#a61717;background-color:#e3d2d2>
</span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#8b008b;font-weight:700>ADD</span> example19-deploy-with-kubernetes/release/linux/amd64/hello /bin/<span style=color:#a61717;background-color:#e3d2d2>
</span><span style=color:#a61717;background-color:#e3d2d2>
</span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#8b008b;font-weight:700>ENTRYPOINT</span> [<span style=color:#cd5555>&#34;/bin/hello&#34;</span>]<span style=color:#a61717;background-color:#e3d2d2>
</span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>plugins/base:multiarch</code> 用的是 docker scratch 最小 image 搭配 SSL 憑證檔案，接著把 go 編譯出來的二進制檔案放入，所以整體容器大小已經是最小的了。看看 drone 怎麼上傳到 <a href=https://hub.docker.com/>DockerHub</a>。</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7>7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8>8</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#8b008b;font-weight:700>docker_golang</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>plugins/docker:17.12<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>secrets</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span>docker_username, docker_password ]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>repo</span>:<span style=color:#bbb> </span>appleboy/golang-http<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>dockerfile</span>:<span style=color:#bbb> </span>example19-deploy-with-kubernetes/Dockerfile<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>default_tags</span>:<span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>when</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>event</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span>push, tag ]<span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>default_tags</code> 會自動將 <code>master</code> 分支上傳到 <code>latest</code> 標籤，而假設上傳 <code>1.1.1</code> 版本時，drone 則會幫忙編譯出三個不同的 tag 標籤，分別是 <code>1</code>, <code>1.1</code>, <code>1.1.1</code> 這是完全符合 <a href=https://semver.org/>Semantic Versioning</a>，如果有在開源專案打滾的朋友們，一定知道版本的重要性。而 Drone 在這地方提供了很簡單的設定讓開發者可以上傳一次 tag 做到三種不同的 image 標籤。</p>
<h2 id=部署更新-kubernetes>部署更新 Kubernetes</h2>
<p>這邊推薦大家使用 <a href=https://github.com/Sh4d1/drone-kubernetes>Sh4d1/drone-kubernetes</a> 外掛，使用之前請先設定好三個參數:</p>
<ol>
<li>KUBERNETES_SERVER</li>
<li>KUBERNETES_CERT</li>
<li>KUBERNETES_TOKEN</li>
</ol>
<p><code>KUBERNETES_SERVER</code> 可以打開家目錄底下的 <code>~/.kube/config</code> 檔案直接找到，cert 及 token 請先透過 pod 找到 secret token name:</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>$ kubectl describe po/frontend-9f5ccc8d4-8n9xq | grep SecretName | grep token
    SecretName:  default-token-r5xdx
</code></pre></td></tr></table>
</div>
</div><p>拿到 secret name 之後，再透過底下指令找到 <code>ca.crt</code> 及 <code>token</code></p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>$ kubectl get secret default-token-r5xdx -o yaml | egrep <span style=color:#cd5555>&#39;ca.crt:|token:&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>其中 token 還需要透過 base64 decode 過，才可以設定到 drone secret。完成上述步驟後，可以來設定 drone 部署:</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#8b008b;font-weight:700>deploy</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>sh4d1/drone-kubernetes<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>kubernetes_template</span>:<span style=color:#bbb> </span>example19-deploy-with-kubernetes/deployment.yml<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>kubernetes_namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>secrets</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span>kubernetes_server, kubernetes_cert, kubernetes_token ]<span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>deployment.yml</code> 就是該服務的 deploy 檔案:</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42>42</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43>43</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>extensions/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>frontend<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># these labels can be applied automatically</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># from the labels in the pod template if not set</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>app</span>:<span style=color:#bbb> </span>gotraining<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>tier</span>:<span style=color:#bbb> </span>frontend<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># this replicas value is default</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># modify it according to your case</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#b452cd>3</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># selector can be applied automatically</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># from the labels in the pod template if not set</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22># selector:</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22>#   app: guestbook</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#228b22>#   tier: frontend</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>strategy</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>type</span>:<span style=color:#bbb> </span>RollingUpdate<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>rollingUpdate</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>maxSurge</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#b452cd>5</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>template</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>app</span>:<span style=color:#bbb> </span>gotraining<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>tier</span>:<span style=color:#bbb> </span>frontend<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>go-hello<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>appleboy/golang-http:VERSION<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#8b008b;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#8b008b;font-weight:700>cpu</span>:<span style=color:#bbb> </span>100m<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#8b008b;font-weight:700>memory</span>:<span style=color:#bbb> </span>100Mi<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>ports</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#8b008b;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#b452cd>8080</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>FOR_GODS_SAKE_PLEASE_REDEPLOY<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#8b008b;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#39;THIS_STRING_IS_REPLACED_DURING_BUILD&#39;</span><span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>大家可以找到 <code>image: appleboy/golang-http:VERSION</code>，這邊需要寫個 sed 指令來取代 <code>VERSION</code>，部署到 staging 則是 <code>latest</code>，如果是 tag 則取代為 <code>DRONE_TAG</code></p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7>7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8>8</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-makefile data-lang=makefile><span style=color:#a61717;background-color:#e3d2d2>ifneq</span> <span style=color:#a61717;background-color:#e3d2d2>(</span><span style=color:#8b008b;font-weight:700>$(</span><span style=color:#00688b>DRONE_TAG</span><span style=color:#8b008b;font-weight:700>)</span><span style=color:#a61717;background-color:#e3d2d2>,)</span>
    <span style=color:#00688b>VERSION</span> ?= <span style=color:#8b008b;font-weight:700>$(</span>DRONE_TAG<span style=color:#8b008b;font-weight:700>)</span>
<span style=color:#a61717;background-color:#e3d2d2>else</span>
    <span style=color:#00688b>VERSION</span> ?= latest
<span style=color:#a61717;background-color:#e3d2d2>endif</span>

<span style=color:#008b45>prepare</span>:
    sed -ie <span style=color:#cd5555>&#34;s/VERSION/</span><span style=color:#8b008b;font-weight:700>$(</span>VERSION<span style=color:#8b008b;font-weight:700>)</span><span style=color:#cd5555>/g&#34;</span> deployment.yml
</code></pre></td></tr></table>
</div>
</div><p>這邊有個問題就是，我們怎麼讓在同一個 image:latest 下，也可以保持更新 App 呢，首先必須設定 <code>imagePullPolicy</code> 為 <code>Always</code>，以及設定一個 env 讓 drone 可以動態修改 template 檔案</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#8b008b;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>FOR_GODS_SAKE_PLEASE_REDEPLOY<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#39;THIS_STRING_IS_REPLACED_DURING_BUILD&#39;</span><span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>目的是讓每次 kubernetes 都可以讀取不一樣的 template 確保 image 都可以即時更新，假設少了上述步驟，是無法讓 staging 保持更新狀態。畢竟使用 kubectl apply 時，如果 yaml 檔案是沒有更動過的，就不會更新。</p>
<div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-makefile data-lang=makefile><span style=color:#008b45>prepare</span>:
    sed -ie <span style=color:#cd5555>&#34;s/VERSION/</span><span style=color:#8b008b;font-weight:700>$(</span>VERSION<span style=color:#8b008b;font-weight:700>)</span><span style=color:#cd5555>/g&#34;</span> deployment.yml
    sed -ie <span style=color:#cd5555>&#34;s/THIS_STRING_IS_REPLACED_DURING_BUILD/</span><span style=color:#8b008b;font-weight:700>$(</span>shell date<span style=color:#8b008b;font-weight:700>)</span><span style=color:#cd5555>/g&#34;</span> deployment.yml
    cat deployment.yml
</code></pre></td></tr></table>
</div>
</div><p>而 Tag 就不用擔心，原因就是 <code>VERSION</code> 就會改變不一樣的值，所以肯定會即時更新，那假設團隊想要上傳相同 tag (這是不好的做法，請盡量不要使用)，這時候動態修改 env 的作法就發揮功效了。從上面的教學，現在我們看安新的透過 GitHub Flow 來完成部署 Staging 及 Production 了。</p>
<h2 id=影片簡介>影片簡介</h2>
<p>下面影片並無包含實作部分，會介紹我在團隊怎麼使用 <a href=https://guides.github.com/introduction/flow/>GitHub Flow</a> 部署，更多實作詳細細節，可以參考 Udemy 上面影片</p>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/qLla47eJUQc style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
<h2 id=心得>心得</h2>
<p>作者我尚未深入玩過 <a href=https://about.gitlab.com/features/gitlab-ci-cd/>GitLab CI</a> 或者是 <a href=https://jenkins.io/>Jenkins</a> 搭配 Kubernetes 來部署專案，但是我相信以複雜及學習難度來說，用 Drone CI 是比較簡單的，這部分就不多說了，大家實際操作比較過才知道。希望能帶給有在玩 Drone 的開發者有些幫助。另外我在 Udemy 上面開了兩門課程，一門 drone 另一門 golang 教學，如果對這兩門課有興趣的話，都可以購買，目前都是特價 $1800</p>
<ul>
<li><a href="https://www.udemy.com/golang-fight/?couponCode=GOLANG-TOP">Go 語言實戰</a> $1800</li>
<li><a href="https://www.udemy.com/devops-oneday/?couponCode=DRONE-DEVOPS">一天學會 DEVOPS 自動化流程</a> $1800</li>
</ul>
<p>如果兩們都有興趣想一起合買，請直接匯款到下面帳戶，特價 <strong>$3000</strong></p>
<ul>
<li>富邦銀行: 012</li>
<li>富邦帳號: 746168268370</li>
<li>匯款金額: 台幣 $3000 元</li>
</ul>
<p>匯款後請直接到 <a href=http://facebook.com/appleboy46>FB 找我</a>，或者直接寫信給我也可以 <strong>appleboy.tw AT gmail.com</strong>。有任何問題都可以直接加我 FB，都是公開資訊。上面程式碼範例請參考[此連結]]<a href=https://github.com/go-training/training/tree/master/example19-deploy-with-kubernetes>21</a></p>
<div class=blog-tags>
<a href=https://blog.wu-boy.com/tags/drone/>drone</a>&nbsp;
<a href=https://blog.wu-boy.com/tags/golang/>golang</a>&nbsp;
<a href=https://blog.wu-boy.com/tags/kubernetes/>kubernetes</a>&nbsp;
</div>
<hr>
<section id=social-share>
<div class="list-inline footer-links">
<div class=share-box aria-hidden=true>
<ul class=share>
<li>
<a href="//twitter.com/share?url=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f&text=Drone%20%e6%90%ad%e9%85%8d%20Kubernetes%20%e9%83%a8%e7%bd%b2%20Go%20%e8%aa%9e%e8%a8%80%e9%a0%85%e7%9b%ae&via=appleboy" target=_blank title="Share on Twitter">
<i class="fab fa-twitter"></i>
</a>
</li>
<li>
<a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f" target=_blank title="Share on Facebook">
<i class="fab fa-facebook"></i>
</a>
</li>
<li>
<a href="//reddit.com/submit?url=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f&title=Drone%20%e6%90%ad%e9%85%8d%20Kubernetes%20%e9%83%a8%e7%bd%b2%20Go%20%e8%aa%9e%e8%a8%80%e9%a0%85%e7%9b%ae" target=_blank title="Share on Reddit">
<i class="fab fa-reddit"></i>
</a>
</li>
<li>
<a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f&title=Drone%20%e6%90%ad%e9%85%8d%20Kubernetes%20%e9%83%a8%e7%bd%b2%20Go%20%e8%aa%9e%e8%a8%80%e9%a0%85%e7%9b%ae" target=_blank title="Share on LinkedIn">
<i class="fab fa-linkedin"></i>
</a>
</li>
<li>
<a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f&title=Drone%20%e6%90%ad%e9%85%8d%20Kubernetes%20%e9%83%a8%e7%bd%b2%20Go%20%e8%aa%9e%e8%a8%80%e9%a0%85%e7%9b%ae" target=_blank title="Share on StumbleUpon">
<i class="fab fa-stumbleupon"></i>
</a>
</li>
<li>
<a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.wu-boy.com%2f2018%2f06%2fdrone-kubernetes-with-golang%2f&description=Drone%20%e6%90%ad%e9%85%8d%20Kubernetes%20%e9%83%a8%e7%bd%b2%20Go%20%e8%aa%9e%e8%a8%80%e9%a0%85%e7%9b%ae" target=_blank title="Share on Pinterest">
<i class="fab fa-pinterest"></i>
</a>
</li>
</ul>
</div>
</div>
</section>
<h4 class=see-also>See also</h4>
<ul>
<li><a href=/2021/10/introduction-to-open-police-agent-in-mopconf/>Introduction to Open Policy Agent 初探權限控管機制</a></li>
<li><a href=/2021/09/control-system-process-using-supervisor-in-golang/>用 Supervisor 管理系統程式</a></li>
<li><a href=/2021/09/graceful-shutdown-with-nsq-consumers/>NSQ Consumers 處理 Graceful Shutdown 技巧</a></li>
<li><a href=/2021/09/speed-up-amazon-sagemaker-training-using-efs-or-fsx-lustre/>用 AWS EFS 或 FSx Lustre 加速 Sagemaker AI 模型訓練</a></li>
<li><a href=/2021/08/drone-license/>開源專案 Drone CI/CD 平台真的免費嗎？</a></li>
<li><a href=/2021/06/integratate-sagemaker-workflow-using-golang-api/>AI 團隊整合導入 AWS SageMaker 流程</a></li>
<li><a href=/2021/06/graceful-stop-service-using-docker-compose-in-golang/>用 docker-compose 優雅關閉服務</a></li>
<li><a href=/2021/06/what-is-different-between-new-and-make-in-golang/>Go 語言內 new 跟 make 使用時機</a></li>
<li><a href=/2021/05/migrate-wordpress-to-hugo/>將部落格從 Wordpress 轉換到 Hugo</a></li>
<li><a href=/2021/05/graceful-shutdown-with-progress-bar-in-golang/>如何取得上傳進度條 progress bar 相關數據及實作 Graceful Shutdown</a></li>
</ul>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://blog.wu-boy.com/2018/05/how-to-write-testing-in-golang/ data-toggle=tooltip data-placement=top title="如何在 Go 專案內寫測試">&larr; Previous Post</a>
</li>
<li class=next>
<a href=https://blog.wu-boy.com/2018/06/how-to-write-benchmark-in-go/ data-toggle=tooltip data-placement=top title="如何在 Go 語言內寫效能測試">Next Post &rarr;</a>
</li>
</ul>
<div class=disqus-comments>
<button id=show-comments class="btn btn-default" type=button>Show <span class=disqus-comment-count data-disqus-url=https://blog.wu-boy.com/2018/06/drone-kubernetes-with-golang>comments</span></button>
<div id=disqus_thread></div>
<script type=text/javascript>var disqus_config=function(){this.page.url='https://blog.wu-boy.com/2018/06/drone-kubernetes-with-golang'}</script>
</div>
</div>
</div>
</div>
<footer class=post-footer>
<div class=container>
<div class=row>
<div class="col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=mailto:appleboy.tw@gmail.com title="Email me">
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://www.facebook.com/appleboy46 title=Facebook>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://github.com/appleboy title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://gitlab.com/appleboy title=GitLab>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://bitbucket.org/appleboy title=Bitbucket>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-bitbucket fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://twitter.com/appleboy title=Twitter>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/appleboy title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://www.youtube.com/channel/UCLCZJ9d_I7UJP2bpXpge8KA title=Youtube>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href title=RSS>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
<a href=https://blog.wu-boy.com>Appleboy</a>
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://blog.wu-boy.com>小惡魔 - AppleBOY</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.90.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://blog.wu-boy.com/js/main.js></script>
<script>(function(){var c='003841896160749976666:l9i5hqttpqi',a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,a.src='https://cse.google.com/cse.js?cx='+c,b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)})()</script>
<script type=text/javascript>$(function(){$('#show-comments').on('click',function(){var a='appleboy48';(function(){var b=document.createElement('script');b.type='text/javascript',b.async=!0,b.src='//'+a+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(b)})(),$(this).hide()})})</script>
<script id=dsq-count-scr src=//appleboy48.disqus.com/count.js async></script>
<div class=back-to-top id=back-to-top>
<i class="fas fa-angle-double-up"></i>
</div>
</body>
</html>